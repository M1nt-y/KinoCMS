"use strict";(self["webpackChunkkino_cms"]=self["webpackChunkkino_cms"]||[]).push([[617],{89:function(e,t){t.Z=(e,t)=>{const s=e.__vccOpts||e;for(const[l,a]of t)s[l]=a;return s}},1123:function(e,t,s){s.d(t,{_:function(){return o}});s(7658);var l=s(1020),a=s(7329),i=s(1294),n=s(36);const o=(0,l.Q_)({id:"Newsletter",state:()=>({loading:!1,showModal:!1,smsUsers:[],emailUsers:[],templateList:[],smsPicked:"",emailPicked:"",templatePicked:""}),actions:{async getTemplates(){this.loading=!0,this.templateList=[];const e=(0,i.iH)(a.tO,"templates"),t=await(0,n.PL)((0,n.hJ)(a.db,"templates"));t.forEach((e=>{this.templateList.push({id:this.templateList.length,name:e.id,uploaded:!0,file:null,fileName:e.data().fileName})})),(0,i.aF)(e).then((e=>{0!==e.items.length&&e.items.forEach((e=>{console.log(e)}))})).catch((e=>{console.log(e)})),this.loading=!1},async deleteTemplate(e){if(this.showModal=!1,this.loading=!0,this.templateList[e].fileName===this.templatePicked&&(this.templatePicked=""),this.templateList[e].uploaded){await(0,n.oe)((0,n.JU)(a.db,"templates",this.templateList[e].name));const t=(0,i.iH)(a.tO,"templates/"+this.templateList[e].name);(0,i.oq)(t).catch((e=>{console.error(e)}))}this.templateList.splice(e,1);for(let t=0;t<this.templateList.length;t++)this.templateList[t].id!==t&&(this.templateList[t].id=t);this.loading=!1},async uploadTemplates(){this.loading=!0;for(let t=0;t<this.templateList.length;t++)if(null!==this.templateList[t].file){try{const e=(0,i.iH)(a.tO,"templates/"+this.templateList[t].name);await(0,i.KV)(e,this.templateList[t].file)}catch(e){console.error("Error uploading template: ",e)}await(0,n.pl)((0,n.JU)(a.db,"templates",this.templateList[t].name),{fileName:this.templateList[t].fileName})}this.loading=!1}}})},988:function(e,t,s){s.d(t,{U:function(){return o}});s(7658);var l=s(1020),a=s(36),i=s(7329),n=s(9125);const o=(0,l.Q_)({id:"Users",state:()=>({loading:!1,showModal:!1,usersList:[],uploaded:!1}),actions:{async getUsers(){this.loading=!0,this.usersList=[];const e=await(0,a.PL)((0,a.hJ)(i.db,"users"));e.forEach((e=>{this.usersList.push({id:this.usersList.length,name:e.id,email:e.data().email,password:e.data().password,username:e.data().username,registrationDate:e.data().registrationDate,fullName:e.data().fullName,phone:e.data().phone,creditCard:e.data().creditCard,birthday:e.data().birthday,city:e.data().city,address:e.data().address,gender:e.data().gender,language:e.data().language,emailChange:e.data().email,passwordChange:"",passwordCheck:""})}));for(let t=0;t<this.usersList.length;t++)"object"===typeof this.usersList[t].birthday&&(this.usersList[t].birthday=new Date(1e3*this.usersList[t].birthday.seconds));this.loading=!1},async deleteUser(e){this.showModal=!1,this.loading=!0;const t=(0,n.v0)(i.nG);(0,n.e5)(t,this.usersList[e].email,this.usersList[e].password).then((t=>{const s=t.user;(0,n.h8)(s).then((async()=>{await(0,a.oe)((0,a.JU)(i.db,"users",this.usersList[e].name)),this.usersList.splice(e,1);for(let e=0;e<this.usersList.length;e++)this.usersList[e].id!==e&&(this.usersList[e].id=e)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)})),this.loading=!1},async saveUser(e){this.loading=!0,this.uploaded=!1;const t=(0,n.v0)(i.nG);(0,n.e5)(t,this.usersList[e].email,this.usersList[e].password).then((async t=>{const s=t.user;s.email!==this.usersList[e].emailChange&&(this.usersList[e].email=this.usersList[e].emailChange,(0,n.s)(s,this.usersList[e].emailChange).catch((e=>{console.log(e)}))),""!==this.usersList[e].passwordChange&&this.usersList[e].passwordChange===this.usersList[e].passwordCheck&&this.usersList[e].password!==this.usersList[e].passwordChange&&(this.usersList[e].password=this.usersList[e].passwordChange,(0,n.gQ)(s,this.usersList[e].password).catch((e=>{console.log(e)})));const l={email:this.usersList[e].email,password:this.usersList[e].password,username:this.usersList[e].username,registrationDate:this.usersList[e].registrationDate,fullName:this.usersList[e].fullName,phone:this.usersList[e].phone,creditCard:this.usersList[e].creditCard,birthday:this.usersList[e].birthday,city:this.usersList[e].city,address:this.usersList[e].address,gender:this.usersList[e].gender,language:this.usersList[e].language};await(0,a.pl)((0,a.JU)(i.db,"users",this.usersList[e].name),l).then((()=>{this.uploaded=!0}))})).catch((e=>{console.log(e)})),this.loading=!1}}})},1135:function(e,t,s){s.d(t,{Z:function(){return p}});var l=s(3396),a=s(9242);const i=e=>((0,l.dD)("data-v-2487a2fa"),e=e(),(0,l.Cn)(),e),n={class:"modal-content"},o=i((()=>(0,l._)("div",{class:"modal-header"},[(0,l._)("h1",null,"Confirm deletion")],-1))),d=i((()=>(0,l._)("div",{class:"modal-body"},[(0,l._)("h3",null,"Are you sure you want to delete?")],-1))),r={class:"modal-footer justify-content-between"};function u(e,t,s,i,u,c){return(0,l.wg)(),(0,l.iD)("div",{class:"modal-delete",onClick:t[3]||(t[3]=t=>e.$emit("closeModal"))},[(0,l._)("div",{class:"modal-dialog",onClick:t[2]||(t[2]=(0,a.withModifiers)((()=>{}),["stop"]))},[(0,l._)("div",n,[o,d,(0,l._)("div",r,[(0,l._)("button",{class:"btn btn-default",onClick:t[0]||(t[0]=t=>e.$emit("closeModal"))},"Cancel"),(0,l._)("button",{class:"btn btn-danger",onClick:t[1]||(t[1]=t=>e.$emit("confirmDeletion"))},"Confirm")])])])])}var c={name:"DeleteModal"},m=s(89);const h=(0,m.Z)(c,[["render",u],["__scopeId","data-v-2487a2fa"]]);var p=h},4283:function(e,t,s){s.d(t,{Z:function(){return m}});var l=s(3396);const a=e=>((0,l.dD)("data-v-60e77b62"),e=e(),(0,l.Cn)(),e),i={class:"loading"},n=a((()=>(0,l._)("span",null,null,-1))),o=[n];function d(e,t,s,a,n,d){return(0,l.wg)(),(0,l.iD)("div",i,o)}var r={name:"TheLoading"},u=s(89);const c=(0,u.Z)(r,[["render",d],["__scopeId","data-v-60e77b62"]]);var m=c},3877:function(e,t,s){s.r(t),s.d(t,{default:function(){return I}});s(7658);var l=s(3396),a=s(4870),i=s(9242),n=s(7139),o=s(988),d=s(1123),r=s(4283),u=s(1135);const c=e=>((0,l.dD)("data-v-423fd63e"),e=e(),(0,l.Cn)(),e),m={class:"newsletter"},h={class:"newsletter__wrapper"},p=c((()=>(0,l._)("h2",null,"SMS",-1))),_={class:"newsletter__radio"},w=c((()=>(0,l._)("p",null,"Choose",-1))),v=c((()=>(0,l._)("label",{for:"smsAll"},"All users",-1))),g=c((()=>(0,l._)("label",{for:"smsSelect"},"Selectively",-1))),f={class:"newsletter__content"},L={class:"newsletter__content-column"},U={class:"newsletter__content-item"},y=c((()=>(0,l._)("p",null,"SMS text",-1))),k=["disabled"],S={class:"newsletter__content-column"},b={class:"newsletter__wrapper"},C=c((()=>(0,l._)("h2",null,"Email",-1))),P={class:"newsletter__radio"},M=c((()=>(0,l._)("p",null,"Choose",-1))),D=c((()=>(0,l._)("label",{for:"emailAll"},"All users",-1))),N=c((()=>(0,l._)("label",{for:"emailSelect"},"Selectively",-1))),A={class:"newsletter__content"},H={class:"newsletter__content-column"},T=c((()=>(0,l._)("span",null,"Upload HTML letter",-1))),z={class:"newsletter__content-column"},E={class:"newsletter__content-wrapper"},Z=c((()=>(0,l._)("h5",null,"List of latest uploaded newsletter templates",-1))),V={key:0,class:"newsletter__content-templates"},j=["value"],J=["onClick"],F={key:1},O={name:"AdminNewsletter"};var R=Object.assign(O,{setup(e){const t=(0,o.U)(),s=(0,d._)();t.getUsers(),s.getTemplates();const c=(0,l.Fl)((()=>"All"===s.smsPicked?t.usersList.length:s.smsUsers.length)),O=(0,a.iH)(""),R=(0,l.Fl)((()=>O.value.length)),q=(0,a.iH)(0),x=(0,a.iH)(0),I=(0,a.iH)(!1);async function Q(){if(0!==c.value&&""!==O.value){q.value=x.value=0,I.value=!0;for(let e=0;e<c.value;e++)q.value++,x.value=Math.ceil(q.value/c.value*100),await new Promise((e=>setTimeout(e,100)));I.value=!1}}const $=(0,a.iH)("");function G(e){let t=e.target.files[0];$.value=t.name,5===s.templateList.length&&s.deleteTemplate(0),s.templateList.push({id:s.templateList.length,name:"template-"+Date.now(),uploaded:!1,fileName:t.name,file:t})}let K=null;function W(e){s.showModal=!0,K=e}const Y=(0,l.Fl)((()=>{let e="";return""!==s.templatePicked&&s.templateList.forEach((t=>{t.name===s.templatePicked&&(e=t.fileName)})),e})),B=(0,l.Fl)((()=>"All"===s.emailPicked?t.usersList.length:s.emailUsers.length)),X=(0,a.iH)(0),ee=(0,a.iH)(0);async function te(){if(0!==B.value&&""!==s.emailPicked){s.uploadTemplates(),X.value=ee.value=0;for(let e=0;e<B.value;e++)X.value++,ee.value=Math.ceil(X.value/B.value*100),await new Promise((e=>setTimeout(e,100)))}}return(e,t)=>{const o=(0,l.up)("router-link");return(0,l.wg)(),(0,l.iD)("div",m,[(0,l.wy)((0,l.Wm)((0,a.SU)(r.Z),null,null,512),[[i.vShow,(0,a.SU)(s).loading]]),(0,a.SU)(s).showModal?((0,l.wg)(),(0,l.j4)((0,a.SU)(u.Z),{key:0,onConfirmDeletion:t[0]||(t[0]=e=>(0,a.SU)(s).deleteTemplate((0,a.SU)(K))),onCloseModal:t[1]||(t[1]=e=>(0,a.SU)(s).showModal=!1)})):(0,l.kq)("",!0),(0,l._)("div",h,[p,(0,l._)("div",_,[w,(0,l.wy)((0,l._)("input",{type:"radio",id:"smsAll",value:"All","onUpdate:modelValue":t[2]||(t[2]=e=>(0,a.SU)(s).smsPicked=e)},null,512),[[i.vModelRadio,(0,a.SU)(s).smsPicked]]),v,(0,l.wy)((0,l._)("input",{type:"radio",id:"smsSelect",value:"Select","onUpdate:modelValue":t[3]||(t[3]=e=>(0,a.SU)(s).smsPicked=e)},null,512),[[i.vModelRadio,(0,a.SU)(s).smsPicked]]),g,"Select"===(0,a.SU)(s).smsPicked?((0,l.wg)(),(0,l.j4)(o,{key:0,to:{name:"ChooseUsers",params:{id:"sms"}}},{default:(0,l.w5)((()=>[(0,l.Uk)(" Select users ")])),_:1})):(0,l.kq)("",!0)]),(0,l._)("div",f,[(0,l._)("div",L,[(0,l._)("div",U,[y,(0,l._)("p",null,"Symbols: "+(0,n.zw)((0,a.SU)(R)),1)]),(0,l.wy)((0,l._)("textarea",{class:"form-control","onUpdate:modelValue":t[4]||(t[4]=e=>O.value=e),disabled:I.value},null,8,k),[[i.vModelText,O.value]])]),(0,l._)("div",S,[(0,l._)("p",null,"SMS count: "+(0,n.zw)((0,a.SU)(c)),1),(0,l._)("p",null,"SMS sent: "+(0,n.zw)(q.value)+" ("+(0,n.zw)(x.value)+"%) ",1)])]),(0,l._)("button",{class:"btn btn-primary",onClick:Q},"Start")]),(0,l._)("div",b,[C,(0,l._)("div",P,[M,(0,l.wy)((0,l._)("input",{type:"radio",id:"emailAll",value:"All","onUpdate:modelValue":t[5]||(t[5]=e=>(0,a.SU)(s).emailPicked=e)},null,512),[[i.vModelRadio,(0,a.SU)(s).emailPicked]]),D,(0,l.wy)((0,l._)("input",{type:"radio",id:"emailSelect",value:"Select","onUpdate:modelValue":t[6]||(t[6]=e=>(0,a.SU)(s).emailPicked=e)},null,512),[[i.vModelRadio,(0,a.SU)(s).emailPicked]]),N,"Select"===(0,a.SU)(s).emailPicked?((0,l.wg)(),(0,l.j4)(o,{key:0,to:{name:"ChooseUsers",params:{id:"email"}}},{default:(0,l.w5)((()=>[(0,l.Uk)(" Select users ")])),_:1})):(0,l.kq)("",!0)]),(0,l._)("div",A,[(0,l._)("div",H,[(0,l._)("label",null,[T,(0,l._)("input",{class:"newsletter__content-input",type:"file",accept:"text/html",onChange:t[7]||(t[7]=e=>G(e))},null,32)]),(0,l._)("p",null,"Uploaded file: "+(0,n.zw)($.value),1),(0,l._)("p",null,"Chosen template in current newsletter: "+(0,n.zw)((0,a.SU)(Y)),1),(0,l._)("p",null,"Emails count: "+(0,n.zw)((0,a.SU)(B)),1),(0,l._)("p",null,"Emails sent: "+(0,n.zw)(X.value)+" ("+(0,n.zw)(ee.value)+"%)",1)]),(0,l._)("div",z,[(0,l._)("div",E,[Z,(0,a.SU)(s).templateList.length>0?((0,l.wg)(),(0,l.iD)("div",V,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,a.SU)(s).templateList,(e=>((0,l.wg)(),(0,l.iD)("div",{class:"newsletter__content-template",key:e.id},[(0,l._)("label",null,[(0,l.wy)((0,l._)("input",{type:"radio",value:e.name,"onUpdate:modelValue":t[8]||(t[8]=e=>(0,a.SU)(s).templatePicked=e)},null,8,j),[[i.vModelRadio,(0,a.SU)(s).templatePicked]]),(0,l._)("span",null,(0,n.zw)(e.fileName),1)]),(0,l._)("p",{onClick:t=>W(e.id)},"Delete",8,J)])))),128))])):((0,l.wg)(),(0,l.iD)("p",F,"No uploaded templates"))])])]),(0,l._)("button",{class:"btn btn-primary",onClick:te},"Start")])])}}}),q=s(89);const x=(0,q.Z)(R,[["__scopeId","data-v-423fd63e"]]);var I=x}}]);
//# sourceMappingURL=newsletter.f6c0145e.js.map